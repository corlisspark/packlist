<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Setup Admin Config - PacksList</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
    .error { background: #ffebee; color: #c62828; }
    .success { background: #e8f5e8; color: #2e7d32; }
    .warning { background: #fff3e0; color: #ef6c00; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #4CAF50; color: white; }
    button:hover { background: #45a049; }
    #log { background: #f5f5f5; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    .admin-info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>Setup Admin Configuration</h1>
  <p>This will configure <strong>sxpxru@gmail.com</strong> as the admin account.</p>
  
  <div class="admin-info">
    <h3>üëë Admin Account Configuration</h3>
    <p><strong>Primary Admin:</strong> sxpxru@gmail.com</p>
    <p><strong>Backup Admin:</strong> admin@packslist.com</p>
  </div>
  
  <div id="status" class="status warning">
    <strong>Status:</strong> <span id="status-text">Ready to setup admin configuration</span>
  </div>
  
  <button onclick="setupAdminConfig()">Setup Admin Configuration</button>
  <button onclick="checkAdminConfig()">Check Current Admin Config</button>
  <button onclick="clearLog()">Clear Log</button>
  
  <h3>Log:</h3>
  <div id="log"></div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    function log(message, type = 'info') {
      const logEl = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'orange' : 'black';
      logEl.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
      logEl.scrollTop = logEl.scrollHeight;
    }
    
    function updateStatus(text, type = 'info') {
      const statusEl = document.getElementById('status');
      const statusText = document.getElementById('status-text');
      statusText.textContent = text;
      statusEl.className = `status ${type}`;
    }
    
    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    const adminConfig = {
      adminEmails: [
        'sxpxru@gmail.com',
        'admin@packslist.com'
      ],
      superAdminEmails: [
        'sxpxru@gmail.com'
      ],
      defaultRoles: {
        'sxpxru@gmail.com': 'super_admin',
        'admin@packslist.com': 'admin'
      },
      permissions: {
        admin: [
          'browse', 'post', 'moderate', 'manage_users', 'view_analytics'
        ],
        super_admin: [
          'browse', 'post', 'moderate', 'manage_users', 'view_analytics', 
          'manage_settings', 'manage_admins', 'delete_data'
        ]
      },
      lastUpdated: new Date().toISOString(),
      updatedBy: 'system'
    };

    async function setupAdminConfig() {
      updateStatus('Setting up admin configuration...', 'warning');
      log('Creating admin configuration...');
      
      if (!window.db) {
        log('‚ùå Firestore not initialized', 'error');
        updateStatus('Error: Firebase not ready', 'error');
        return;
      }

      try {
        await window.db.collection('config').doc('auth-settings').set(adminConfig);
        log('‚úÖ Admin configuration created successfully', 'success');
        log('üëë sxpxru@gmail.com is now configured as super admin', 'success');
        log('üîß admin@packslist.com is configured as backup admin', 'success');
        updateStatus('Admin configuration complete!', 'success');
      } catch (error) {
        log(`‚ùå Failed to create admin config: ${error.message}`, 'error');
        updateStatus('Failed to setup admin configuration', 'error');
      }
    }

    async function checkAdminConfig() {
      log('Checking current admin configuration...');
      
      if (!window.db) {
        log('‚ùå Firestore not initialized', 'error');
        return;
      }

      try {
        const doc = await window.db.collection('config').doc('auth-settings').get();
        if (doc.exists) {
          const data = doc.data();
          log('‚úÖ Admin config exists', 'success');
          log(`üìß Admin emails: ${data.adminEmails?.join(', ')}`, 'success');
          log(`üëë Super admin emails: ${data.superAdminEmails?.join(', ')}`, 'success');
          log(`üìÖ Last updated: ${data.lastUpdated}`, 'info');
        } else {
          log('‚ùå Admin config does not exist', 'error');
        }
      } catch (error) {
        log(`‚ùå Cannot check admin config: ${error.message}`, 'error');
      }
    }

    // Wait for Firebase to initialize
    setTimeout(() => {
      if (window.db) {
        log('‚úÖ Firebase initialized and ready');
        updateStatus('Ready to setup admin configuration', 'success');
      } else {
        log('‚ùå Firebase not ready after timeout', 'error');
        updateStatus('Error - Firebase not ready', 'error');
      }
    }, 2000);
  </script>
</body>
</html>