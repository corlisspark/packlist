<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - PacksList</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../auth/auth-styles.css">
  <link rel="stylesheet" href="admin-styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
  <div class="admin-container">
    
    <!-- Admin Header -->
    <header class="admin-header">
      <div class="admin-header-content">
        <div class="admin-logo">
          <div class="logo-icon">üåø</div>
          <span class="logo-text">PacksList Admin</span>
        </div>
        <div class="admin-header-actions">
          <div class="admin-user-info">
            <span id="admin-user-name">Admin User</span>
            <span class="admin-badge">üëë</span>
          </div>
          <button class="btn btn-outline btn-sm" onclick="window.location.href='../index.html'">
            üè† Back to Site
          </button>
          <button class="btn btn-link btn-sm" onclick="window.authManager.signOut()">
            Sign Out
          </button>
        </div>
      </div>
    </header>

    <div class="admin-layout">
      
      <!-- Sidebar Navigation -->
      <nav class="admin-sidebar">
        <div class="sidebar-content">
          
          <!-- Quick Stats -->
          <div class="quick-stats">
            <div class="stat-item">
              <div class="stat-number" id="pending-count">0</div>
              <div class="stat-label">Pending</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="users-count">0</div>
              <div class="stat-label">Users</div>
            </div>
          </div>

          <!-- Navigation Menu -->
          <ul class="admin-nav">
            <li class="nav-item">
              <a href="#dashboard" class="nav-link active" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#packs" class="nav-link" data-section="packs">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Pack Moderation</span>
                <span class="nav-badge" id="packs-badge">0</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#users" class="nav-link" data-section="users">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">User Management</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#analytics" class="nav-link" data-section="analytics">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">Analytics</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#vendors" class="nav-link" data-section="vendors">
                <span class="nav-icon">üè™</span>
                <span class="nav-text">Vendors</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#locations" class="nav-link" data-section="locations">
                <span class="nav-icon">üìç</span>
                <span class="nav-text">Locations</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#config" class="nav-link" data-section="config">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Configuration</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#logs" class="nav-link" data-section="logs">
                <span class="nav-icon">üìù</span>
                <span class="nav-text">Audit Logs</span>
              </a>
            </li>
          </ul>

        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="admin-main">
        
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="admin-section active">
          <div class="section-header">
            <h1>Dashboard</h1>
            <div class="section-actions">
              <button class="btn btn-outline" onclick="adminManager.refreshData()">
                üîÑ Refresh
              </button>
            </div>
          </div>

          <!-- Metrics Grid -->
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-icon">üì¶</div>
              <div class="metric-content">
                <div class="metric-number" id="total-packs">0</div>
                <div class="metric-label">Total Packs</div>
                <div class="metric-change" id="packs-change">+0 today</div>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">‚è≥</div>
              <div class="metric-content">
                <div class="metric-number" id="pending-packs">0</div>
                <div class="metric-label">Pending Review</div>
                <div class="metric-change urgent" id="pending-change">Needs attention</div>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">üë•</div>
              <div class="metric-content">
                <div class="metric-number" id="total-users">0</div>
                <div class="metric-label">Total Users</div>
                <div class="metric-change" id="users-change">+0 today</div>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">üö©</div>
              <div class="metric-content">
                <div class="metric-number" id="flagged-content">0</div>
                <div class="metric-label">Flagged Content</div>
                <div class="metric-change" id="flagged-change">0 unresolved</div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <h3>Quick Actions</h3>
            <div class="action-grid">
              <button class="action-card" onclick="adminManager.showSection('packs')">
                <div class="action-icon">‚ö°</div>
                <div class="action-title">Review Pending</div>
                <div class="action-subtitle" id="quick-pending-count">0 packs waiting</div>
              </button>
              <button class="action-card" onclick="adminManager.bulkApprove()">
                <div class="action-icon">‚úÖ</div>
                <div class="action-title">Bulk Approve</div>
                <div class="action-subtitle">Safe packs only</div>
              </button>
              <button class="action-card" onclick="adminManager.showSection('users')">
                <div class="action-icon">üë§</div>
                <div class="action-title">Manage Users</div>
                <div class="action-subtitle">Roles & permissions</div>
              </button>
              <button class="action-card" onclick="adminManager.showSection('config')">
                <div class="action-icon">üîß</div>
                <div class="action-title">Settings</div>
                <div class="action-subtitle">Platform config</div>
              </button>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="recent-activity">
            <h3>Recent Activity</h3>
            <div id="activity-feed" class="activity-feed">
              <div class="loading">Loading recent activity...</div>
            </div>
          </div>

        </section>

        <!-- Pack Moderation Section -->
        <section id="packs-section" class="admin-section">
          <div class="section-header">
            <h1>Pack Moderation</h1>
            <div class="section-actions">
              <select id="pack-filter" class="filter-select">
                <option value="pending">Pending Review</option>
                <option value="all">All Packs</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
                <option value="flagged">Flagged</option>
              </select>
              <button class="btn btn-primary" onclick="adminManager.bulkApprove()">
                Bulk Approve Safe
              </button>
            </div>
          </div>

          <!-- Pack Review Queue -->
          <div id="pack-review-queue" class="review-queue">
            <div class="loading">Loading packs for review...</div>
          </div>

        </section>

        <!-- User Management Section -->
        <section id="users-section" class="admin-section">
          <div class="section-header">
            <h1>User Management</h1>
            <div class="section-actions">
              <input type="text" id="user-search" placeholder="Search users..." class="search-input">
              <select id="user-role-filter" class="filter-select">
                <option value="all">All Roles</option>
                <option value="user">Users</option>
                <option value="admin">Admins</option>
                <option value="banned">Banned</option>
              </select>
            </div>
          </div>

          <!-- Users Table -->
          <div id="users-table" class="users-table">
            <div class="loading">Loading users...</div>
          </div>

        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="admin-section">
          <div class="section-header">
            <h1>Analytics</h1>
            <div class="section-actions">
              <select id="analytics-period" class="filter-select">
                <option value="7d">Last 7 Days</option>
                <option value="30d">Last 30 Days</option>
                <option value="90d">Last 90 Days</option>
              </select>
            </div>
          </div>

          <!-- Analytics Charts -->
          <div class="analytics-grid">
            <div class="chart-card">
              <h3>Pack Submissions</h3>
              <div id="packs-chart" class="chart-container">
                <div class="chart-placeholder">üìä Chart coming soon</div>
              </div>
            </div>
            <div class="chart-card">
              <h3>User Registrations</h3>
              <div id="users-chart" class="chart-container">
                <div class="chart-placeholder">üìä Chart coming soon</div>
              </div>
            </div>
            <div class="chart-card">
              <h3>Geographic Distribution</h3>
              <div id="geo-chart" class="chart-container">
                <div class="chart-placeholder">üó∫Ô∏è Map coming soon</div>
              </div>
            </div>
            <div class="chart-card">
              <h3>Popular Categories</h3>
              <div id="categories-chart" class="chart-container">
                <div class="chart-placeholder">üìà Chart coming soon</div>
              </div>
            </div>
          </div>

        </section>

        <!-- Vendors Management Section -->
        <section id="vendors-section" class="admin-section">
          <div class="section-header">
            <h1>Vendor Management</h1>
            <div class="section-actions">
              <button class="btn btn-primary" onclick="adminManager.showAddVendorModal()">
                ‚ûï Add Vendor
              </button>
            </div>
          </div>

          <!-- Vendors List -->
          <div class="vendors-container">
            <div class="vendors-grid" id="vendors-grid">
              <div class="loading">Loading vendors...</div>
            </div>
          </div>
        </section>

        <!-- Locations Management Section -->
        <section id="locations-section" class="admin-section">
          <div class="section-header">
            <h1>Location Management</h1>
            <div class="section-actions">
              <button class="btn btn-primary" onclick="adminManager.showAddLocationModal()">
                ‚ûï Add Location
              </button>
            </div>
          </div>

          <!-- Locations List -->
          <div class="locations-container">
            <div class="locations-grid" id="locations-grid">
              <div class="loading">Loading locations...</div>
            </div>
          </div>
        </section>

        <!-- Configuration Section -->
        <section id="config-section" class="admin-section">
          <div class="section-header">
            <h1>Configuration</h1>
            <div class="section-actions">
              <button class="btn btn-outline" onclick="adminManager.resetConfig()">
                Reset to Defaults
              </button>
              <button class="btn btn-primary" onclick="adminManager.saveConfig()">
                Save Changes
              </button>
            </div>
          </div>

          <!-- Configuration Tabs -->
          <div class="config-tabs">
            <button class="tab-btn active" data-tab="general">General</button>
            <button class="tab-btn" data-tab="security">Security</button>
            <button class="tab-btn" data-tab="features">Features</button>
            <button class="tab-btn" data-tab="appearance">Appearance</button>
          </div>

          <!-- Configuration Forms -->
          <div id="config-forms" class="config-forms">
            <div class="loading">Loading configuration...</div>
          </div>

        </section>

        <!-- Audit Logs Section -->
        <section id="logs-section" class="admin-section">
          <div class="section-header">
            <h1>Audit Logs</h1>
            <div class="section-actions">
              <select id="log-level" class="filter-select">
                <option value="all">All Levels</option>
                <option value="info">Info</option>
                <option value="warning">Warning</option>
                <option value="error">Error</option>
              </select>
              <input type="date" id="log-date" class="date-input">
              <button class="btn btn-outline" onclick="adminManager.exportLogs()">
                Export Logs
              </button>
            </div>
          </div>

          <!-- Logs Table -->
          <div id="logs-table" class="logs-table">
            <div class="loading">Loading audit logs...</div>
          </div>

        </section>

      </main>

    </div>

  </div>

  <!-- Admin Action Modals -->
  <div id="admin-modals">
    <!-- Vendor Management Modal -->
    <div id="vendor-modal" class="admin-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="vendor-modal-title">Add Vendor</h3>
          <button class="close-btn" onclick="adminManager.closeVendorModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="vendor-form">
            <div class="form-group">
              <label for="vendor-name">Vendor Name *</label>
              <input type="text" id="vendor-name" required>
            </div>
            <div class="form-group">
              <label for="vendor-color">Brand Color *</label>
              <input type="color" id="vendor-color" value="#8e44ad" required>
            </div>
            <div class="form-group">
              <label for="vendor-icon">Icon (single character) *</label>
              <input type="text" id="vendor-icon" maxlength="1" required>
            </div>
            <div class="form-group">
              <label for="vendor-description">Description</label>
              <textarea id="vendor-description" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="vendor-priority">Priority (lower = higher priority)</label>
              <input type="number" id="vendor-priority" min="1" value="1">
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="vendor-active" checked>
                <span>Active (visible to users)</span>
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="adminManager.closeVendorModal()">Cancel</button>
          <button class="btn btn-primary" onclick="adminManager.saveVendor()">Save Vendor</button>
        </div>
      </div>
    </div>

    <!-- Location Management Modal -->
    <div id="location-modal" class="admin-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="location-modal-title">Add Location</h3>
          <button class="close-btn" onclick="adminManager.closeLocationModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="location-form">
            <div class="form-group">
              <label for="location-name">Location Name *</label>
              <input type="text" id="location-name" required>
            </div>
            <div class="form-group">
              <label for="location-lat">Latitude *</label>
              <input type="number" id="location-lat" step="0.000001" required>
            </div>
            <div class="form-group">
              <label for="location-lng">Longitude *</label>
              <input type="number" id="location-lng" step="0.000001" required>
            </div>
            <div class="form-group">
              <label for="location-timezone">Timezone</label>
              <select id="location-timezone">
                <option value="America/New_York">Eastern Time</option>
                <option value="America/Chicago">Central Time</option>
                <option value="America/Denver">Mountain Time</option>
                <option value="America/Los_Angeles">Pacific Time</option>
              </select>
            </div>
            <div class="form-group">
              <label for="location-priority">Priority (lower = higher priority)</label>
              <input type="number" id="location-priority" min="1" value="1">
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="location-active" checked>
                <span>Active (available for selection)</span>
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="location-default">
                <span>Default location (fallback)</span>
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="adminManager.closeLocationModal()">Cancel</button>
          <button class="btn btn-primary" onclick="adminManager.saveLocation()">Save Location</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="../firebase-config.js"></script>
  <script src="../config-manager.js"></script>
  <script src="../vendor-manager.js"></script>
  <script src="../dynamic-location-manager.js"></script>
  <script src="../auth/auth-manager.js"></script>
  <script src="../email/emailjs-setup.js"></script>
  <script src="../email/email-integration.js"></script>
  <script src="admin-manager.js"></script>
  <script src="pack-moderation.js"></script>
  <script src="user-management.js"></script>
  <script src="audit-logger.js"></script>
</body>
</html>